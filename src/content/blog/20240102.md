---
title: 'ğŸªµ åœ°ã‚’ã¤ãã‚‹ã€Bevy + Rustã€‘'
topics: ['1_bevy']
authors:
    - tokunaga
description: 'Part2 - I have started developing a game where vending machines take center stage'
pubDate: 'Jan 2 2024'
heroImage: '/img/hongwei-fan-AH3CI9tBI-E-unsplash.jpg'
---

## åˆæœŸçŠ¶æ…‹ã‹ã‚‰ä¸€æ­©é€²ã‚ã‚‹

ã•ã¦ï¼Œæœ€åˆã®`main.rs`ã®çŠ¶æ…‹ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ï¼

```rust title="main.rs"
use bevy::prelude::*;

fn main() {
    App::new().run();
}
```

ã“ã®ã¾ã¾ã ã¨ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚‚ç«‹ã¡ä¸ŠãŒã‚‰ãšã«å³æ™‚å®Œäº†ã—ã¦ã—ã¾ã„ã¾ã™ã­ï¼
ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’èµ·å‹•ã•ã›ã¦ã‚‚çœŸã£æš—ãªçŠ¶æ…‹ã§ã™ã®ã§ï¼Œç‰©ä½“ã‚’è¦‹ã‚‹ãŸã‚ã®ã‚«ãƒ¡ãƒ©ï¼Œãã—ã¦åœ°é¢ã‚’è¨­ç½®ã—ã¦ã„ãã¾ã™ï¼

æœ€çµ‚çš„ã«`.exe`ã®å½¢ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹æ–¹é‡ã§è€ƒãˆã¦ãŠã‚Šï¼ŒWeb ã‚¢ã‚»ãƒ³ãƒ–ãƒªåŒ–ã™ã‚‹äºˆå®šã¯ä»Šã®ã¨ã“ã‚ã‚ã‚Šã¾ã›ã‚“ï¼

### å®Ÿè£…â… ï¼šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®èµ·å‹•

ä»¥ä¸‹ã®é€šã‚Šï¼Œã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼
â€»importç®‡æ‰€ã¯å‰²æ„›

```rust ins={3-5, 9-15} title="main.rs" frame="code"
fn main() {
    App::new()
        .add_plugins(DefaultPlugins)
        .add_systems(Startup, setup)
        .add_systems(Update, hello_world)
        .run();
}

fn setup() {
    println!("setup");
}

fn hello_world() {
    println!("hello world");
}
```

ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ ã«`setup`é–¢æ•°ã‚’ï¼Œã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã«`hello_world`ã‚’è¨­å®šã—ã¦ã„ã¾ã™ï¼

å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã§ã™ï¼

```sh frame="code"
cargo run
```

ç­†è€…ã®ç’°å¢ƒ[^1]ã®å ´åˆï¼Œã“ã®ã‚³ãƒ¼ãƒ‰é‡ã§ã‚‚ãƒ“ãƒ«ãƒ‰ã«ç´„15 åˆ†ç¨‹åº¦è¦ã—ã¾ã—ãŸï¼

[^1]: PC ã‚¹ãƒšãƒƒã‚¯ã«ã¤ã„ã¦ã¯[ã“ã¡ã‚‰](/about)ã‚’ã”å‚ç…§ãã ã•ã„ï¼

çœŸã£é»’ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒç«‹ã¡ä¸ŠãŒã‚Šï¼Œã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å¤§é‡ã®`hello world`ãŒæµã‚Œã‚‹ã¨æˆåŠŸã§ã™ï¼
ç¬¬ä¸€å¼•æ•°ã«`Update`ã‚’æŒ‡å®šã—ãŸã‚·ã‚¹ãƒ†ãƒ ã¯æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ç¹°ã‚Šè¿”ã—ã¾ã™ï¼
ä½™è¨ˆãªå‡¦ç†ã«ãªã£ã¦ã—ã¾ã†ã®ã§`hello_world`ã¯æ¶ˆã—ã¦ãŠãã¾ã™ï¼

ã“ã“ã§ç”»é¢ã¯æº–å‚™ã§ãã¾ã—ãŸãŒï¼Œã¾ã ç©ºé–“ã«ä½•ã‚‚ã‚ã‚Šã¾ã›ã‚“ï¼
æ¬¡ã®é€šã‚Šå°‘ã—ãšã¤å®Ÿè£…ã—ã¦ã„ãã¾ã™ï¼

1. ç‰©ä½“ã‚’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã«æ˜ ã™ãŸã‚ã®ã‚«ãƒ¡ãƒ©ã‚’ã¤ãã‚‹
2. è‡ªå‹•è²©å£²æ©Ÿã‚’è¨­ç½®ã™ã‚‹ãŸã‚ã®åœ°é¢ã‚’ã¤ãã‚‹

ä¸»äººå…¬ã®è‡ªå‹•è²©å£²æ©Ÿã®è¨­ç½®ã¯æ¬¡å›ã«è­²ã‚Šã¾ã™ï¼

### å®Ÿè£…â…¡ï¼šã‚«ãƒ¡ãƒ©ã‚’è¿½åŠ ã™ã‚‹ (Camera3DBundle)

ã‚«ãƒ¡ãƒ©ã¨ãƒ©ã‚¤ãƒˆã‚’ç½®ãã¾ã™ï¼
ãã‚Œãã‚Œã®Bundle ã‚’åˆ©ç”¨ã—ã¾ã™ï¼

Bundle ã¨ã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é›†åˆã§ã‚ã‚‹ã¨ç†è§£ã—ã¦ã„ã¾ã™ãŒï¼Œ[Unofficeial Bevy Cheat Book](https://bevy-cheatbook.github.io/programming/bundle.html)ã•ã‚“ã®èª¬æ˜ã‚’å¼•ç”¨ã—ã¦ãŠãã¾ã™ï¼
> You can think of Bundles like "templates" or "blueprints" for creating entities. They make it easy to create entities with a common set of components.

```rust del={1-2} ins={3-17} title="main.rs > setup" frame="code"
fn setup() {
    println!("setup");
fn setup(mut commands: Commands) {
    commands.spawn(Camera3dBundle {
        transform: Transform::from_xyz(0.0, 6., 12.0).looking_at(Vec3::new(0., 1., 0.), Vec3::Y),
        ..default()
    });

    commands.spawn(PointLightBundle {
        point_light: PointLight {
            intensity: 5000.0,
            shadows_enabled: true,
            ..default()
        },
        transform: Transform::from_xyz(-3.0, 0.0, 10.0),
        ..default()
    });
}
```

ã§ãã¾ã—ãŸãŒï¼Œã“ã®ã¾ã¾ã§ã‚‚çœŸã£æš—ã®ã¾ã¾ã§ã™ã­ï¼
åœ°é¢ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ï¼

### å®Ÿè£…â…¢ï¼šåœ°é¢ã‚’è¿½åŠ ã™ã‚‹(PbrBundle)

è²©å£²æ©ŸãŒè·¯é¢ã‚’é€šéã—ã¦ã—ã¾ã‚ãªã„ã‚ˆã†ã«ç‰©ç†æ¼”ç®—ãƒ©ã‚¤ãƒ–ãƒ©ãƒª[bevy_xpbd](https://github.com/Jondolf/bevy_xpbd)ã‚’è¿½åŠ ã—ã¾ã™ï¼

```sh
cargo add bevy_xpbd_3d
```

ãã—ã¦è·¯é¢è¿½åŠ ç”¨ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’æ–°ãŸã«å®Ÿè£…ã—ï¼Œ`App`ã«è¿½åŠ ã—ã¾ã™ï¼

```rust ins={4,8-23} title="main.rs" frame="code"
fn main() {
    App::new()
        .add_plugins(DefaultPlugins)
        .add_systems(Startup, (setup, create_road))
        .run();
}

fn create_road(
    mut commands: Commands,
    mut meshes: ResMut<Assets<Mesh>>,
    mut materials: ResMut<Assets<StandardMaterial>>,
) {
    commands.spawn((
        RigidBody::Static,
        Collider::cuboid(0.1, 0.002, 0.1),
        PbrBundle {
            mesh: meshes.add(shape::Plane::from_size(0.1).into()),
            material: materials.add(Color::SILVER.into()),
            transform: Transform::from_xyz(0., -1.5, 0.),
            ..default()
        },
    ));
}
```

ã“ã®ã‚ˆã†ã«ã—ã¦ä½œã£ãŸè·¯é¢ãŒã“ã¡ã‚‰ã§ã™ï¼
ç°è‰²ã®ç‚¹ã¨ã—ã¦æç”»ã•ã‚Œã¦ã„ã¾ã™ï¼
è·¯é¢ã®ã‚µã‚¤ã‚ºã¨ã‚«ãƒ¡ãƒ©ã®ä½ç½®ãŒæ‚ªã‹ã£ãŸã‚ˆã†ã§ã™ï¼

![result of create_road](../../assets/images/20240102/road.png)

## Appendix

||Version|
|-|-|
|Rust|1.77 - nightly|
|Bevy|0.12.1|
|||

