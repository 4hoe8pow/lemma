---
title: '🐳 開発環境用のDockerfile'
topics: ['2_linux']
authors:
    - tokunaga
description: 'Docker'
pubDate: 'Feb 6 2024'
heroImage: '/img/ubu.jpg'
---

## Dockerfile

```dockerfile title="Dockerfile"
# ベースイメージを指定
FROM archlinux/archlinux:base-devel
LABEL maintainer="Yu Tokunaga <tokunaga@agni.ninja>"

# メタデータを追加
ARG UID=1000
ARG GID=1000
ARG USERNAME=hoe
ARG LOCATE=JP
ARG COUNTRY=ja_JP
ARG ENCODE=UTF-8
ENV TZ=Asia/Tokyo

# Install git
RUN pacman -Syu --needed --noconfirm git \
  # Install yay
  && git clone https://aur.archlinux.org/yay.git \
  && cd yay \
  && makepkg -sri --needed --noconfirm \
  && cd .. \
  # Upgrade
  && yay -Syu \
  # Clean up
  && rm -rf /var/cache/pacman/pkg/* \
  && rm -rf ~/.cache yay

# makepkg user(hoe) and workdir
ARG user=hoe
RUN useradd --system --create-home $user \
  && echo "$user ALL=(ALL:ALL) NOPASSWD:ALL" > /etc/sudoers.d/$user
USER $user

# 環境変数を設定
ENV HOME_PATH=/home/$user
ENV XDG_CONFIG_HOME=$HOME_PATH/.config

WORKDIR $HOME_PATH

# Install essential packages
RUN yay -S --needed --noconfirm fish exa ripgrep procs neovim rustup fzf \
  # Fish
  && sudo chsh $user -s $(which fish) \
  # Fisherman
  && curl -Lo $XDG_CONFIG_HOME/fish/functions/fisher.fish --create-dirs https://git.io/fisher \
  && fish -c "fisher install oh-my-fish/theme-bobthefish" \
  # alt cd
  && fish -c "fisher install jethrokuan/z" \
  # rust
  && rustup default nightly \
  # Lazy.nvim
  && git clone https://github.com/4hoe8pow/nvimenv $XDG_CONFIG_HOME/nvim \
  && rm -rf $XDG_CONFIG_HOME/nvim/.git \
  # Git
  && sudo git config --system alias.a add \
  && sudo git config --system alias.c commit \
  && sudo git config --system alias.p push \
  && sudo git config --system alias.st status \
  && sudo git config --system alias.gr "log --graph --date=short --decorate=short --pretty=format:'%Cgreen%h %Creset%cd %Cblue%cn %Cred%d %Creset%s'" \
  && sudo git config --system alias.empty "commit --allow-empty -m 'Initial commit'" \
  && sudo git config --system alias.ch checkout

# Command Alias
ARG fishrc=$XDG_CONFIG_HOME/fish/config.fish
RUN echo "# Shell Operations" >> $fishrc \
  && echo "alias v='nvim'" >> $fishrc \
  && echo "alias l='exa --color auto --icons'" >> $fishrc \
  && echo "alias la='exa -la --color auto --icons'" >> $fishrc \
  && echo "alias ll='exa -l --color auto --icons'" >> $fishrc \
  && echo "alias tree='exa -T -L 3 --color auto --icons'" >> $fishrc \
  && echo "alias grep='rg'" >> $fishrc \
  && echo "alias ps='procs'" >> $fishrc \
  && echo "# Git" >> $fishrc \
  && echo "alias g='git'" >> $fishrc \
  && echo "alias gst='git st'" >> $fishrc \
  && echo "alias ga='git a'" >> $fishrc \
  && echo "alias gc='git c'" >> $fishrc \
  && echo "alias gp='git p'" >> $fishrc \
  && funcsave fish_config

# キャッシュ削除
RUN sudo pacman -Scc --noconfirm \
  && sudo yay -Scc --noconfirm

ENTRYPOINT [ "fish" ]
```
