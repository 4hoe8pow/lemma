---
title: 'ğŸ± Snaplet ã‚’åˆ©ç”¨ã—ã¦ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’æ¥½ã«ä½œã‚‹ with Supabase'
topics: ['6_test']
authors:
    - tokunaga
description: 'fake data using AI.'
pubDate: 'Feb 28 2024'
heroImage: '/img/cat.jpg'
---

## çµŒç·¯

Snapletã¯ã€é–‹ç™ºè€…ãŒå®Ÿéš›ã®æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ãã‚‹ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

Snapletã§ã¯æœ¬ç•ªã«è¿‘ã„ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ãŒ2ã¤ç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚
æ—¢å­˜ã®ã‚½ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹**Snapshot**ã€è‹¥ã—ãã¯ã€ç”ŸæˆAIã«ã‚ˆã£ã¦ãƒ•ã‚§ã‚¤ã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹**Seed**ã§ã™ã€‚

Snapletå…¬å¼ã«ã¯å¾Œè€…ã‚’æ¨å¥¨ã—ã¦ãŠã‚Šã€æœ¬ç¨¿ã§ã‚‚Seedã‚’è©¦ã—ã¾ã™ã€‚

## æº–å‚™

```sh
pnpm dlx snaplet setup
```

`DATABASE_URL`ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒèã‹ã‚Œã‚‹ã®ã¿ã§ã™ã€‚
ç§ã®ç’°å¢ƒã§ã¯ãŠã‚ˆã2åˆ†ã»ã©ã‹ã‹ã‚Šã¾ã—ãŸã€‚

ã¾ãŸã€ãƒ­ãƒ¼ã‚«ãƒ«ã§Supabase on Dockerã‚’å‹•ã‹ã—ã¦ã„ã‚‹çŠ¶æ³ã§ã™ã€‚
`supabase start`ã§èµ·å‹•ã—ãŸã¨ãã«å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ä»¥ä¸‹ã®æƒ…å ±ã‚’`DATABASE_URL`ã¨ã—ã¾ã™ã€‚

```txt
postgresql://postgres:postgres@127.0.0.1:54322/postgres
```

`127.0.0.1`ã‚’æ¨ªç€ã—ã¦`localhost`ã¨ã™ã‚‹ã¨å‹•ãã¾ã›ã‚“ã€‚

ã•ã¦ã€ã†ã¾ãã„ãã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã«`seed.mts`ãŒè¿½åŠ ã•ã‚Œã¾ã™ã€‚
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆæœŸãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦è¿½åŠ ã—ãŸè¨­å®šã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚

## è¦ä»¶ã®è¨˜è¿°

```ts title="seed.mts"
import { createSeedClient } from '@snaplet/seed';
import { copycat } from '@snaplet/copycat';

const seed = await createSeedClient({
  dryRun: process.env.DRY !== '0'
});

await seed.$resetDatabase()

await seed.posts([
  {
    title: 'Hello World!',
    author: {
      email: (ctx) =>
        copycat.email(ctx.seed, {
          domain: 'acme.org',
        }),
    },
    comments: (x) => x(3),
  },
]);
```

`await seed.$resetDatabase()`ã¾ã§ã¯ãŠç´„æŸã¿ãŸã„ãªã‚‚ã®ã§ã™ã€‚
`seed`ã®å¾Œã®ãƒ¡ã‚½ãƒƒãƒ‰åã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§ã®ãƒ†ãƒ¼ãƒ–ãƒ«åãŒè¤‡æ•°å½¢ã«ãªã£ãŸã‚‚ã®ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚
å˜æ•°å½¢ã§ç™»éŒ²ã—ã¦ã‚ˆã†ãŒã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒ–ãƒ«åãŒè¤‡æ•°å½¢ã«ãªã‚Šã¾ã™ã€‚

ã“ã®`x`ãƒ¡ã‚½ãƒƒãƒ‰ãŒå„ªç§€ã§ã€ã‚«ãƒ©ãƒ ã®å‹ã«åˆã‚ã›ã¦ã„ã„æ„Ÿã˜ã®æ–‡å­—åˆ—ã‚’å½“ã¦ã¯ã‚ã¦ãã‚Œã¾ã™ã€‚
å¼•æ•°ã«ã¯ç”Ÿæˆã™ã‚‹æ•°ãŒå…¥ã‚Šã¾ã™ã€‚

SQLãƒ•ã‚¡ã‚¤ãƒ«ã«åæ˜ ã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```sh
pnpm dlx tsx seed.mts > supabase/seed.sql
```

å…ˆã»ã©ã®TypeScriptã§ä»¥ä¸‹ã®`seed.sql`ãŒå‡ºæ¥ä¸ŠãŒã‚Šã¾ã™ã€‚

```sql title="seed.sql"
INSERT INTO public.user (email,id,username) VALUES
('Craig.Bednar82365@acme.org', '24058b0d-21ec-54b8-a3fa-b0ad8034f10f', 'site-glance56860'),
('Humberto.Bruen34274@meternephew.org', '241ed1d9-c36c-50d4-b783-e12ce5187076', 'Alexis-Gleason29168'),
('Mattie.Braun26688@plodantechamber.com', '8c84c800-1b34-5843-b34b-73d3239f0c5b', 'blissful-fountain21234'),
('Dannie_Osinski74665@brownmidline.name', '0e041e68-00c0-53db-b0f8-e28be8a009e0', 'visualise-service97805');

INSERT INTO public.post (title,content,author_id,id) VALUES
('Hello World!', 'Ramo ramukin rae racea rakesoma, me vayota yume vi keyo munavima.', '24058b0d-21ec-54b8-a3fa-b0ad8034f10f', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf');

INSERT INTO public.comment (content,id,post_id,author_id,written_at) VALUES
('Ma ceasova yuviketa shira chiyomu.', '13fdf8d2-2199-5dfd-81d0-c8dd3ce3b8a6', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf', '241ed1d9-c36c-50d4-b783-e12ce5187076', DEFAULT),
('Mukinra kahyceako kiva kai me hameso rae.', '71a504eb-a859-5217-9e27-e15975ac69c6', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf', '8c84c800-1b34-5843-b34b-73d3239f0c5b', DEFAULT),
('Ma nacea va memumi ta, mami viyua yoma shimusona viyo metake.', '8e826b31-f774-57f3-8ef2-183bddb35f3e', '1a294726-1661-5d42-aaf6-cdb66e6c6eaf', '0e041e68-00c0-53db-b0f8-e28be8a009e0', DEFAULT);
```

æœ€å¾Œã«ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®Supabaseã«åæ˜ ã—ã¾ã™ã€‚

```sh
supabase db reset
```

## å‚è€ƒ

<https://www.snaplet.dev>
